$(document).ready(function () {    $('#_box_att_est').hide();});$('#_avanti').on('click', function () {    $('#_icoAvanti').attr('class', 'fa fa-spinner fa-spin');    var currentTab = $("ul#_cvTabs li.active").attr('id');    currentTab = currentTab.substr(currentTab.length - 1);    if ($("#_step"+currentTab).valid()) {        if(checkExperiences(currentTab)){            if (salvaTab(currentTab)){                $('.nav-tabs a[href="#tab_' + (Number(currentTab)+1) + '"]').tab('show');                var newTab = (Number(currentTab)+1);                switch (newTab){                    case 0:                        $("#_indietro").prop('disabled',true);                        break;                    case 1:                    case 2:                        $("#_indietro").prop('disabled',false);                        if (Number($('#_ckcfmail').val()) === 1){                            getPercorsoFormativo($('#_cv_id').val());                        } else {                            if (Number($('#_tlFormazione li').length) <= 1){                                setTimeout(function() {                                    $('#_modalFormazione').modal('show');                                }, 500);                            }                        }                        break;                    case 3:                        $("#_indietro").prop('disabled',false);                        if (Number($('#_ckcfmail').val()) === 1){                            getPercorsoLavorativo($('#_cv_id').val());                        } else {                            if (Number($('#_tlLavoro li').length) <= 1){                                setTimeout(function() {                                    $('#_modalLavoro').modal('show');                                }, 500);                            }                        }                        break;                    case 4:                        $("#_indietro").prop('disabled',false);                        break;                    case 5:                        $('#_avanti').prop('disabled',true);                        if (Number($('#_ckcfmail').val()) === 0){                            if($('#_email_send').val() === "0"){                                sendMailCompany();                                setUserAccount();                            }                                                 }                        break;                }		$('#_icoAvanti').attr('class', 'fa fa-arrow-right');            }        }    } else {            }});function sendMailCompany() {    elemId = $('#_cv_id').val();    $.post('actions/sendMail.php', {id: elemId}, function (returnedData) {        //var obj = returnedData;        var obj = JSON.parse(returnedData);        //alert(obj['result']);        if (obj['result'] === 1) {            $('#_email_send').val('1');        }    });}function setUserAccount() {    elemId = $('#_cv_id').val();    $.post('actions/userCreate.php', {id: elemId}, function (returnedData) {        //var obj = returnedData;        var obj = JSON.parse(returnedData);        //alert(obj['result']);        if (obj['result'] === 1) {            $('#_email_send').val('1');        }    });}function getPercorsoFormativo(cv_id) {    var res = '';    $.ajax({        url: "actions/getPercorsoFormativo.php",        type: 'POST',        data: {            'cv_id': cv_id        },        async: false,        success: function (data) {            $("#_tlFormazione").empty();            $("#_tlFormazione").append(data);        }    });    return res;}function getPercorsoLavorativo(cv_id) {    var res = '';    $.ajax({        url: "actions/getPercorsoLavorativo.php",        type: 'POST',        data: {            'cv_id': cv_id        },        async: false,        success: function (data) {            $("#_tlLavoro").empty();            $("#_tlLavoro").append(data);        }    });    return res;}$(".cfmail").blur(function () {    if (Number($('#_codice_fiscale').val().length) === 16 || Number($('#_email').val().length) > 0){        if (Number($('#_ckcfmail').val()) === 0){            var res;            $.ajax({                url: "actions/checkCfMail.php",                type: 'POST',                data: {                    'cf': $('#_codice_fiscale').val().toUpperCase(),                    'mail': $('#_email').val(),                    'token': $('#_pageToken').val()                },                async: false,                dataType: 'json',                success: function (data) {                    if(data.length !== 0){                        if ($('#_pageToken').val() !== data.cv_token){                            $('#_ckcfmail').val("1");                            $('.cv_id').val(data.cv_id);                            $('#_nome_candidato').val(data.cv_nome);                            $('#_cognome_candidato').val(data.cv_cognome);                            $('#_data_nascita').val(data.cv_data_nascita);                            $('#_luogo_nascita').val(data.cv_luogo_nascita);                                $('#_codice_fiscale').val(data.cv_codice_fiscale);                            $('#_email').val(data.cv_email);                            $('#_telefono').val(data.cv_telefono);                            $('#_indirizzo_residenza').val(data.cv_indirizzo);                            $('#_citta').val(data.cv_citta);                            $('#_cap_residenza').val(data.cv_cap);                            $('#_provincia_residenza').val(data.cv_provincia);                            $('#_sesso option[value="' + data.cv_sesso + '"]').prop('selected', true);                            $('.file-preview-image').attr("src","uploads/images/"+data.cv_file_foto);                            $('#_img_candidato').val(data.cv_file_foto);                            $('#_img_url').attr("class","form-control");                            $('#_lingua_madre').val(data.cv_lingua_madre);                            var lingue = JSON.parse(data.cv_lingue);                            lingue.forEach( function (itm) {                                //$('#_altre_lingue').select2('data', {id: itm, a_key:itm});                                $('#_altre_lingue option[value="' + itm + '"]').prop('selected', true);                                $('#_altre_lingue').trigger('change');                            });                            $('#_patente option[value="' + data.cv_patente + '"]').prop('selected', true);                            //$('#_competenze_comunicative').text(data.cv_comp_comunicative);                            //$('#_competenze_organizzative').text(data.cv_comp_organizzative);                            //$('#_competenze_professionali').text(data.cv_comp_professionali);                            //$('#_competenze_digitali').text(data.cv_comp_digitali);                            $('#_comp_sw_email option[value="' + data.cv_mail_client + '"]').prop('selected', true);                            $('#_comp_social_network option[value="' + data.cv_social_network + '"]').prop('selected', true);                            $('#_comp_sw_grafica option[value="' + data.cv_sw_grafica + '"]').prop('selected', true);                            $('#_comp_commerciali option[value="' + data.cv_comp_commerciali + '"]').prop('selected', true);                            $('#_esperienza_profumeria option[value="' + data.cv_exp_profumeria + '"]').prop('selected', true);                            $('#_esperienza_estetica option[value="' + data.cv_exp_estetica + '"]').prop('selected', true);                            if(Number(data.cv_exp_estetica) === 1){                                $('#_box_att_est').show();                            }                            $('#_attestato_estetista option[value="' + data.cv_qualifica_estetista + '"]').prop('selected', true);                                                        var punti_vendita = JSON.parse(data.cv_preferenza_sede);                            punti_vendita.forEach(function (itm){                               $('#_punti_vendita option[value="' + itm + '"]').prop('selected', true);                               $('#_punti_vendita').trigger('change');                            });                                                                                    $(".form-control").prop('disabled', true);                            $(".addElemento").prop('disabled', true);                            $('#_boxAvviso').fadeIn(function(){                                $('#_boxAvviso').css('display','block');                                $('#_avviso').html("I tuoi dati risultano essere gia in archivio, per modificarli effettua l'accesso nella tua <a href='login.php'>area riservata</a>");                            });                                                    }                    }                    res = data;                }            });            return res;                        }            }    /*    */}); $('#_indietro').click(function () {    var currentTab = $("ul#_cvTabs li.active").attr('id');    currentTab = currentTab.substr(currentTab.length - 1);    $('.nav-tabs a[href="#tab_' + (Number(currentTab)-1) + '"]').tab('show');		newTab = (Number(currentTab)-1);                   switch (newTab){        case 0:        case 1:            $("#_indietro").prop('disabled',true);            break;        case 2:        case 3:        case 4:            $("#_indietro").prop('disabled',false);            $("#_avanti").prop('disabled',false);                        break;        case 5:            $('#_avanti').prop('disabled',true);            break;        } });function checkExperiences(tab){    ret = true;    if(Number(tab) === 2){        if (Number($('#_tlFormazione li').length) <= 1){            $('#_alertForm').css('color','red');            $('#_icoAvanti').attr('class', 'fa fa-arrow-right');            ret = false;        } else {            $('#_alertForm').css('color','black');            ret = true;        }    }    if(Number(tab) === 3){        if (Number($('#_tlLavoro li').length) <= 1){            $('#_alertLav').css('color','red');            $('#_icoAvanti').attr('class', 'fa fa-arrow-right');            ret = false;        } else {            $('#_alertLav').css('color','black');            ret = true;        }    }        return ret;}function salvaTab(tab) {    var statoRitorno;       if (Number($('#_ckcfmail').val()) === 0){        var formData = new FormData($("#_step" + tab).get(0));        $.ajax({            url: "actions/saveSteps.php?step=" + tab,            type: 'POST',            data: formData,            async: false,            dataType: 'json',            success: function (data) {                //console.log(data);                obj = data;                //var obj = JSON.parse(data);                statoRitorno = true;                if ($.isNumeric(obj['id'])) {                    $('.cv_id').val(obj['id']);                    if(Number(tab) === 1) $('#_img_candidato').val(obj['img']);                    // $('#_controllo_errori').val("0");                    //$('#_messaggio_errore').html("");                } else {                    statoRitorno = false;                    //$('#_errore_img').css("display", "block");                    //$('#_messaggio_errore').load("load_errors.php");                    //$('#_controllo_errori').val("1");                }                           },            cache: false,            contentType: false,            processData: false        });    } else {        statoRitorno = true;    }    return statoRitorno;}